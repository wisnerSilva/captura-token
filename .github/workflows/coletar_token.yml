name: Coletar Token

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  coletar_token:
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout do código
        uses: actions/checkout@v4

      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Instalar dependências do sistema
        run: |
          sudo apt-get update
          sudo apt-get install -y --no-install-recommends \
            libnss3 libatk-bridge2.0-0 libxss1 libasound2t64 libgbm1 libgtk-3-0 \
            libxshmfence-dev libxrandr2 libxcomposite1 libxcursor1 libxdamage1 libxi6

      - name: Instalar dependências Python
        run: |
          python -m pip install --upgrade pip
          pip install playwright rich python-dotenv

      - name: Instalar navegadores do Playwright
        run: |
          python -m playwright install --with-deps

      - name: Executar script Python
        run: |
          python src/coletar_token.py
        env:
          EMAIL: ${{ secrets.EMAIL }}
          SENHA: ${{ secrets.SENHA }}
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_KEY: ${{ secrets.SUPABASE_SERVICE_KEY }}
          TABLE_NAME: ${{ secrets.TABLE_NAME }}
          BUCKET_NAME: ${{ secrets.BUCKET_NAME }}
